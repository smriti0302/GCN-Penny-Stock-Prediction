import time
import datetime
import pandas as pd
import requests
import urllib


#make an array of dataframes
#append them all to a master dataframe
#write master to excel


tickers = ['YAMNINV.BO', 'WAGEND.BO', 'VIVIDHA.BO', 'VISIONCINE.BO', 'VIRTUALG.BO', 'VINTRON.BO', 'VIAANINDUS.BO', 'TWINSTAR.BO', 'TSPIRITUAL.BO', 'TRITON.BO', 'TRICOMFRU.BO', 'TATIAGLOB.BO', 'SWORDEDGE.BO', 'SURYACHAKRA.BO', 'STURDY.BO', 'SPYL.NS', 'SPYL.BO', 'SOLISMAR.BO', 'SIPTL.BO', 'SIKOZY.BO', 'SICLTD.BO', 'SEVENHILL.BO', 'SCTL.BO', 'SAWABUSI.BO', 'SATRAPROP.BO', 'SABTN.NS', 'RISAINTL.BO', 'RAJSPTR.BO', 'RADAAN.NS', 'RADAAN.BO', 'QUINTEGRA.NS', 'QUINTEGRA.BO', 'QUADRANT.BO', 'PRECISION.BO', 'ORTEL.NS', 'ORTEL.BO', 'OMANSH.BO', 'NCLRESE.BO', 'MONOT.BO', 'MFLINDIA.BO', 'MAL.BO', 'MAHAVIRIND.BO', 'MAHANIN.BO', 'MAHACORP.BO', 'KRETTOSYS.BO', 'KLIFESTYL.BO', 'KEEPLEARN.NS', 'JIKIND.NS', 'JIKIND.BO', 'JAIMATAG.BO', 'INTERDIGI.BO', 'GTEIT.BO', 'GOYALASS.BO', 'GOLDLINE.BO', 'GEMSI.BO', 'GAYAHWS.NS', 'GANGOTRI.NS', 'FIVEXTRADE.BO', 'EDSL.BO', 'DOLPHMED.BO', 'DIAMANT.BO', 'DHENUBUILD.BO', 'COMPUPN.BO', 'CCFCL.BO', 'BLUECHIP.NS', 'BLUECHIP.BO', 'BITL.BO', 'BHRKALM.BO', 'ARCFIN.BO', 'ANTGRAPHIC.NS', 'AMRAAGRI.BO', 'AMFL.BO', 'ALPSMOTOR.BO', 'ADCON.BO', '7NR.BO', 'STAMPEDE.BO', 'MERCATOR.BO', 'SRESTHA.BO', 'DEVHARI.BO', 'NOUVEAU.BO', 'GVFILM.BO', 'ROLLT.NS', 'LANDMARC.BO', 'TRIOMERC.BO', 'VIVIDHA.NS', 'MERCATOR.NS', 'SHALPRO.BO', 'PUNJLLOYD.BO', 'PUNJLLOYD.NS', 'ROLLT.BO', 'SANWARIA.NS', 'STAMPEDE.NS', 'VISESHINFO.BO', 'JMTAUTOLTD.NS', 'VIKASPROP.NS', 'SANWARIA.BO', 'JMTAUTOLTD.BO', 'AJRINFRA.NS', 'BALLARPUR.BO', 'BALLARPUR.NS', 'ACIIN.BO', 'AISHWARYA.BO', 'ALFL.BO', 'ALPSINDUS.NS', 'ANUBHAV.BO', 'ATHARVENT.BO', 'BCLENTERPR.BO', 'BKMINDST.BO', 'BKMINDST.NS', 'BRIJLEAS.BO', 'BSELINFRA.BO', 'CCCL.BO', 'CCCL.NS', 'CNIRESLTD.BO', 'CRANESSOFT.BO', 'CUBIFIN.BO', 'DIAPOWER.BO', 'DIAPOWER.NS', 'EASUNREYRL.BO', 'EASUNREYRL.NS', 'ESSENTIA.NS', 'FCSSOFT.BO', 'GALADA.BO', 'GEETANJ.BO', 'GFSTEELS.NS', 'GGENG.BO', 'GOENKA.BO', 'GOENKA.NS', 'HAVISHA.NS', 'INDINFO.BO', 'INVENTURE.BO', 'ISFL.BO', 'ISWL.BO', 'JAINSTUDIO.BO', 'JAINSTUDIO.NS', 'JINDCOT.BO', 'JPINFRATEC.BO', 'JTAPARIA.BO', 'KANELIND.BO', 'KHOOBSURAT.BO', 'KORE.BO', 'LUHARUKA.BO', 'MEGACOR.BO', 'MEGLON.BO', 'MILLENNIUM.BO', 'NILASPACES.NS', 'OCTAVE.BO', 'OLPCL.BO', 'PACT.BO', 'PADMALAYAT.BO', 'PANAFIC.BO', 'PRAGBOS.BO', 'PROFINC.BO', 'REGENCERAM.NS', 'REGENTRP.BO', 'RELHOME.BO', 'RHFL.NS', 'RICHAIND.BO', 'RLFL.BO', 'RMCL.BO', 'RMCL.NS', 'RNAVAL.BO', 'ROYALIND.BO', 'SABTN.BO', 'SAGARPROD.BO', 'SATHAISPAT.NS', 'SEATV.BO', 'SETUINFRA.NS', 'SHAQUAK.BO', 'SHARPINV.BO', 'SHRENIK.NS', 'SILVERO.BO', 'SITINET.BO', 'SITINET.NS', 'SNTCL.BO', 'SPENTEX.BO', 'SPENTEX.NS', 'SRIND.BO', 'STRLGUA.BO', 'SUMERUIND.BO', 'SUNGOLD.BO', 'SUPERIOR.BO', 'SUPREMEENG.NS', 'TPROJECT.BO', 'TUNITEX.BO', 'TVVISION.NS', 'UNISHIRE.BO', 'UNIVARTS.BO', 'USHDI.BO', 'VANDANA.BO', 'VAXHS.BO', 'VCKCAP.BO', 'VERTEX.BO', 'VICEROY.BO', 'VICEROY.NS', 'VIKASWSP.BO', 'VIKASWSP.NS', 'VIRTUALS.BO', 'VISAGAR.BO', 'VISIONCO.BO', '4THGEN.BO', 'ADVIKCA.BO', 'BAROEXT.BO', 'BEEYU.BO', 'BGLOBAL.BO', 'BGLOBAL.NS', 'BLSINFOTE.BO', 'CANDC.BO', 'CANDC.NS', 'CHMBBRW.BO', 'CREATIVEYE.NS', 'DATASOFT.BO', 'DCMFINSERV.BO', 'DCMFINSERV.NS', 'DNAMEDIA.BO', 'DNAMEDIA.NS', 'EDUCOMP.BO', 'EDUCOMP.NS', 'EPSOMPRO.BO', 'EXPLICITFIN.BO', 'FEL.NS', 'GAL.BO', 'GAL.NS', 'GAYATRI.BO', 'GLFL.BO', 'GLFL.NS', 'GLITTEKG.BO', 'GRANDFONRY.BO', 'GSLSEC.BO', 'HEERAISP.BO', 'IISL.BO', 'INDOSOLAR.BO', 'INDOSOLAR.NS', 'INDRAIND.BO', 'INFOMEDIA.NS', 'ISTRNETWK.BO', 'JAUSPOL.BO', 'JCTLTD.BO', 'JINDCOT.NS', 'JSHL.BO', 'KAUSHALYA.BO', 'KAUSHALYA.NS', 'KCLINFRA.BO', 'KOCL.BO', 'KRIDHANINF.NS', 'KRIINFRA.BO', 'LCCINFOTEC.NS', 'MADHAVIPL.BO', 'MANGIND.BO', 'MASL.BO', 'MAYURFL.BO', 'MBECL.BO', 'MBECL.NS', 'MELSTAR.BO', 'MELSTAR.NS', 'MINAXI.BO', 'MINOLTAF.BO', 'MUL.BO', 'NAGTECH.BO', 'NATNLSTEEL.BO', 'NATNLSTEEL.NS', 'OMNIAX.BO', 'PADMAIND.BO', 'PANINDIAC.BO', 'PASARI.BO', 'PMCFIN.BO', 'POLYTEX.BO', 'PROMACT.BO', 'QUANTBUILD.BO', 'RAINBOWDQ.BO', 'REGTRUS.BO', 'RESTILE.BO', 'RICHIRICH.BO', 'SAMBHAAV.BO', 'SAMBHAAV.NS', 'SAMTEX.BO', 'SATHAISPAT.BO', 'SERVOTEACH.BO', 'SKIL.BO', 'SKIL.NS', 'SPCENET.NS', 'STELLAR.BO', 'SUNDARAM.BO', 'SUNDARAM.NS', 'SVCIND.BO', 'SYMBIOX.BO', 'TARAPUR.BO', 'TARAPUR.NS', 'TRABI.BO', 'TVVISION.BO', 'UJAAS.BO', 'UJAAS.NS', 'UMESLTD.NS', 'UTLINDS.BO', 'UTTAMSTL.BO', 'UTTAMSTL.NS', 'VFL.BO', 'VIJIFIN.NS', 'VIKASECO.BO', 'WILLIMFI.BO', 'NEXTMEDIA.BO', 'GLOBALCA.BO', 'NEXTMEDIA.NS', 'YOGISUNG.BO', 'MADHUCON.BO', 'MADHUCON.NS', 'POLOHOT.BO', 'OROSMITHS.BO', 'OTCO.BO', 'LIBORDFIN.BO', 'STARLITE.BO', 'CARNATIN.BO', 'KUSHIND.BO', 'JAGSONFI.BO', 'BAGFILMS.NS', 'DECPO.BO', 'TIJARIA.BO', 'BAGFILMS.BO', 'MYSTICELE.BO', 'PMTELELIN.BO', 'NILA.BO', 'HOTELRUGBY.BO', 'DHANADACO.BO', 'LAKPRE.BO', 'DEVINE.BO', 'TIJARIA.NS', 'HARIAEXPO.BO', 'HOTELRUGBY.NS', 'ABHIINFRA.BO', 'RAMASIGNS.BO', 'PVP.NS', 'BRFL.NS', 'PVP.BO', 'TARINI.BO', 'HIMFIBP.BO', 'TCIFINANCE.NS', 'PARENTLD.BO', 'TARAI.BO', 'PRAKASHSTL.BO', 'ASHRAM.BO', 'IOSYSTEM.BO', 'FMNL.BO', 'FMNL.NS', 'PRAKASHSTL.NS', 'GCMCAPI.BO', 'RLF.BO', 'DARJEELING.BO', 'MIDEASTP.BO', 'GUJINV.BO', 'EKAMLEA.BO', 'JHACC.BO', 'ANJANIFIN.BO', 'SHAHISHIP.BO', 'TCIFINANCE.BO', 'HASTIFIN.BO', 'KMFBLDR.BO', 'EASTSILK.BO', 'EASTSILK.NS', 'PANKAJPO.BO', 'BURNPUR.BO', 'BURNPUR.NS', 'JDORGOCHEM.BO', 'VENTURA.BO', 'HINDBIO.BO', 'ANERI.BO', 'SIPIND.BO', 'INFOMEDIA.BO', 'GRAVITY.BO', 'METALFORGE.NS', 'PDPL.NS', 'METALFORGE.BO', 'UNIOFFICE.BO', 'PREMIER.BO', 'ELAND.BO', 'CITYONLINE.BO', 'WINPRO.NS', 'BCP.NS', 'NOGMIND.BO', 'RCRL.BO', 'COUNCODOS.BO', 'CLIOINFO.BO', 'BCP.BO', 'CREATIVEYE.BO', 'SHIVA.BO', 'COUNCODOS.NS', 'IL&FSTRANS.BO', 'SHANGAR.BO', 'MARUTISE.BO', 'SUPREMEX.BO', 'PREMIER.NS', 'GISOLUTION.NS', 'ROLTA.BO', 'ICSL.BO', 'HBLEAS.BO', 'BARTRONICS.NS', 'IL&FSTRANS.NS', 'ROLTA.NS', 'BARTRONICS.BO', 'KABRADG.BO', 'CHANDRIMA.BO', 'GLOBE.NS', 'ANKITMETAL.NS', 'VISTAPH.BO', 'ESARIND.BO', 'RCIIND.BO', 'SABEVENTS.NS', 'GOVNOW.BO', 'GENNEX.BO', 'GREENCREST.BO', 'ALFATRAN.BO', 'ZENITHSTL.NS', 'BPCAP.BO', 'ESHAMEDIA.BO', 'ANSALHSG.NS', 'ANSALHSG.BO', 'USGTECH.BO', 'ESCORTSFIN.BO', 'QUASAR.BO', 'SIDDHA.BO', 'AMFORG.BO', 'INSILCO.BO', 'VELHO.BO', 'SULABEN.BO', 'SAFFRON.BO', 'ORGCOAT.BO', 'DHARFIN.BO', 'INDOCITY.BO', 'ASHAI.BO', 'SOMATEX.BO', 'LORDSHOTL.BO', 'VENLONENT.BO', 'MAYUR.BO', 'SOMATEX.NS', 'OSCARGLO.BO', 'LPDC.BO', 'IVC.BO', 'CITYMAN.BO', 'SUPERTEX.BO', 'LPDC.NS', 'RAJINFRA.BO', 'PATSPINLTD.BO', 'SUPTANERY.BO', 'EPIC.BO', 'AMBITION.BO', 'SUVIDHAA.NS', 'KIRANPR.BO', 'MOHOTAIND.NS', 'MOHOTAIND.BO', 'CHLOGIST.BO', 'MRSS.BO', 'JAYCH.BO', 'RAMAPETRO.BO', 'ZEELEARN.NS', 'SPECTRA.BO', 'ANNAINFRA.BO', 'ARAVALIS.BO', 'SHEETAL.BO', 'SUCROSA.BO', 'GOLECHA.BO', 'ZENITHHE.BO', 'PAEL.BO', 'INDLEASE.BO', 'KIRANSY-B.BO', 'CONTICON.BO', 'VBIND.BO', 'PFLINFOTC.BO', 'BACPHAR.BO', 'RICHUNV.BO', 'UNQTYMI.BO', 'VALLABHSQ.BO', 'ODYCORP.BO', 'GANGAFORGE.NS', 'SMFIL.BO', 'NATHUEC.BO', 'PRIMIND.BO', 'LAKPRE.NS', 'EUROTEXIND.NS', 'IPOWER.BO', 'JAINCO.BO', 'JRFOODS.BO', 'PATIDAR.BO', 'NORBTEAEXP.NS', 'SVAMSOF.BO', 'YURANUS.BO', 'BHANDHOS.BO', 'VASINFRA.BO', 'BHANDARI.NS', 'SINTEXPLAST.BO', 'LYPSAGEMS.BO', 'AMITINT.BO', 'OSWAYRN.BO', 'HOWARHO.BO', 'SBC.NS', 'LYPSAGEMS.NS', 'NYSSACORP.BO', 'CONFINT.BO', 'LAHL.BO', 'UNITINT.BO', 'MUKTA.BO', 'ASHCAP.BO', 'IMPEXFERRO.NS', 'SEASONST.BO', 'TGBHOTELS.BO', 'UMIYA.BO', 'BERYLSE.BO', 'AANANDALAK.BO', 'BERLDRG.BO', 'MUKATPIP.BO', 'OZONEWORLD.BO', 'IFINSER.BO', 'SALSTEEL.BO', 'KAMANWALA.BO', 'TFL.BO', 'YASHRAJC.BO', 'VAMA.BO', 'GUJSTATFIN.BO', 'SALSTEEL.NS', 'REGENCY.BO', 'MTEDUCARE.BO', 'CRANEINFRA.BO', 'SVARTCORP.BO', 'MTEDUCARE.NS', 'OILCOUNTUB.NS', 'TIRSARJ.BO', 'BIHSPONG.BO', 'RUCHINFRA.NS', 'SIBARAUT.BO', 'YARNSYN.BO', 'GBFL.BO', 'ETIL.BO', 'KUWERIN.BO', 'RUCHINFRA.BO', 'MAHALXSE.BO', 'GKCONS.BO', 'GOLCA.BO', 'SICAL.BO', 'FELDVR.NS', 'TFL.NS', 'EXPOGAS.BO', 'PURPLE.BO', 'OILCOUNTUB.BO', 'AML.BO', 'RIGASUG.BO', 'INDINFRA.BO', 'SYNCOMF.BO', 'SENINFO.BO', 'SICAL.NS', 'INFRAIND.BO', 'ATVPR.BO', 'SUDAI.BO', 'JPTSEC.BO', 'ANDHRACEMT.BO', 'SHKARTP.BO', 'ORIENTTR.BO', 'MODAIRY.BO', 'TRIMURTHI.BO', 'PILITA.BO', 'FILATFASH.BO', 'BIRLATYRE.NS', 'GOLDCOINHF.BO', 'SWASTIVI.BO', 'WELCURE.BO', 'OONE.BO', 'SHYMINV.BO', 'CCHHL.BO', 'INNOCORP.BO', 'NOVIS.BO', 'SANKHYAIN.BO', 'CCHHL.NS', 'BKV.BO', 'NOIDATOLL.BO', 'RAJGASES.BO', 'NOIDATOLL.NS', 'FGP.BO', 'SUNRAJDI.BO', 'SYBLY.BO', 'LIBORD.BO', 'WELLNESS.BO', 'SHRGLTR.BO', 'ESSARSEC.BO', 'SUMEETINDS.BO', 'TNTELE.BO', 'SUMEETINDS.NS', 'BAMPSL.BO', 'CORPOCO.BO', 'TNTELE.NS', 'TRINITYLEA.BO', 'ZEAL.BO', 'ANKITMETAL.BO', 'RAMGOPOLY.BO', 'FRASER.BO', 'GUJCOTEX.BO', 'GOPAIST.BO', 'VIKALPS.BO', 'EXCEL.BO', 'EXCEL.NS', 'SURFI.BO', 'ESSARSHPNG.NS', 'ESSARSHPNG.BO', 'GSBFIN.BO', 'ONELIFECAP.NS', 'KISAN.BO', 'RAGHUTOB.BO', 'IYKOTHITE.BO', 'KEL.BO', 'SUPERBAK.BO', 'SHARIKA.BO', 'CHDCHEM.BO', 'MAYUKH.BO', 'RGRL.BO', 'ANKIN.BO', 'SURANAT&P.NS', 'MTPL.BO', 'VIVIMEDLAB.BO', 'VIVIMEDLAB.NS', 'SURANAT&P.BO', 'DHRUVCA.BO', 'RKDL.NS', 'SUMIT.NS', 'TILAK.BO', 'NDASEC.BO', 'RKDL.BO', 'ANSINDUS.BO', 'GARWAMAR.BO', 'NATPLY.BO', 'HELPAGE.BO', 'HINFLUR.BO', 'A2ZINFRA.BO', 'A2ZINFRA.NS', 'PARSVNATH.BO', 'ELANGO.BO', 'SUPERSPIN.BO', 'CENTEXT.BO', 'PENINLAND.BO', 'TIRUPATIFL.NS', 'CENTEXT.NS', 'SUPERSPIN.NS', 'FRUTION.BO', 'RASIELEC.BO', 'MATHEWE.BO', 'ADITYA.BO', 'HITTCO.BO', 'MESCON.BO', 'ASHOKRE.BO', 'TTIL.BO', 'VBDESAI.BO', 'MITSHI.BO', 'BRIDGESE.BO', 'YASHMGM.BO', 'UNJHAFOR.BO', 'TELECANOR.BO', 'UNITEDTE.BO', 'WINSOMBR.BO', 'SHVFL.BO', 'FACORALL.BO', 'CAPRICORN.BO', 'STARLIT.BO', 'AJEL.BO', 'LOOKS.BO', 'ROYALCU.BO', 'SCAPDVR.NS', 'ARCEEIN.BO', 'SCAGRO.BO', 'SANCO.NS', 'SCAPDVR.BO', 'RAINBOWF.BO', 'GAGAN.BO', 'SHALIWIR.BO', 'HOTLSILV.BO', 'CAPFIN.BO', 'MPAGI.BO', 'AKSHOPTFBR.NS', 'LGBFORGE.BO', 'AKSHOPTFBR.BO', 'NIHARINF.BO', 'ELEFLOR.BO', 'PRISMMEDI.BO', 'DUKEOFS.BO', 'BALTE.BO', 'MKTCREAT.BO', 'ZMULTIPU.BO', 'ZSVARAJT.BO', 'IDM.BO', 'KAPILRAJ.BO', 'INDCEMCAP.BO', 'KAVVERITEL.BO', 'KKFIN.BO', 'MARSONS.BO', 'IMPEXFERRO.BO', 'NUTECGLOB.BO', 'GREENPOWER.BO', 'KINETRU.BO', 'PARKERAC.BO', 'CATVISION.BO', 'GTL.NS', 'VINTAGES.BO', 'GTL.BO', 'KAVVERITEL.NS', 'TGBHOTELS.NS', 'IMPEXFERRO.NS', 'SKYLMILAR.BO']
interval = '1d'
period1 = int(time.mktime(datetime.datetime(2010, 1, 1, 23, 59).timetuple()))
period2 = int(time.mktime(datetime.datetime(2020, 12, 31, 23, 59).timetuple()))

#xlwriter = pd.ExcelWriter('abc.xlsx', engine='openpyxl')
dataframeList = []
filename= "closingprices.xlsx"
for ticker1 in tickers:
    query_string1 = f'https://query1.finance.yahoo.com/v7/finance/download/{ticker1}?period1={period1}&period2={period2}&interval={interval}&events=history&includeAdjustedClose=true' 
    r = requests.head(query_string1)
    try:
        df = pd.read_csv(query_string1)
        print(ticker1, r.status_code)

    except urllib.error.HTTPError:
        print(ticker1, "failed to connect", r.status_code)
    else:
        df1 = df.filter(items=['Date'])
        dataframeList.append(df1)
        break

for ticker in tickers:
#for ticker in tickers:
    query_string = f'https://query1.finance.yahoo.com/v7/finance/download/{ticker}?period1={period1}&period2={period2}&interval={interval}&events=history&includeAdjustedClose=true' 
    try:
        df = pd.read_csv(query_string)
        r = requests.head(query_string)
        print(ticker, r.status_code)

    except urllib.error.HTTPError:
        print(ticker, "failed to connect")
        continue
    else:
        df1 = df.filter(items=['Close'])
        df1.rename(columns={'Close':ticker}, inplace = True)
        dataframeList.append(df1)
print(dataframeList)
print(len(dataframeList))
final = pd.concat(dataframeList, axis = 1)
print("FINAL:\n\n\n", final)
xlwriter = pd.ExcelWriter(filename)
final.to_excel(xlwriter, index=False)
xlwriter.save()
	

